diff --git a/camlibs/lumix/lumix.c b/camlibs/lumix/lumix.c
index d72da46..c8177d9 100644
--- a/camlibs/lumix/lumix.c
+++ b/camlibs/lumix/lumix.c
@@ -36,10 +36,15 @@
 #include <libxml/xmlreader.h>
 
 
-#include <sys/socket.h>
+#ifdef WIN32
+# include <winsock2.h>
+# include <ws2tcpip.h>
+#else
+# include <sys/socket.h>
+# include <netinet/in.h>
+# include <arpa/inet.h>
+#endif
 #include <stdlib.h>
-#include <netinet/in.h>
-#include <arpa/inet.h>
 
 
 #include <gphoto2/gphoto2-library.h>
diff --git a/camlibs/st2205/Makefile-files b/camlibs/st2205/Makefile-files
index 93a1efb..8a85bfb 100644
--- a/camlibs/st2205/Makefile-files
+++ b/camlibs/st2205/Makefile-files
@@ -10,3 +10,7 @@ st2205_la_LDFLAGS = $(camlib_ldflags)
 st2205_la_DEPENDENCIES = $(camlib_dependencies)
 st2205_la_LIBADD = $(camlib_libadd) @LIBGD_LIBS@ $(LTLIBICONV)
 st2205_la_CFLAGS = @LIBGD_CFLAGS@
+
+# On systems such as mingw/Windows, mmap(2) is not part of the
+# standard library and needs an explicit library to link against.
+st2205_la_LIBADD += $(MMAP_LIBS)
diff --git a/configure.ac b/configure.ac
index 4b5e12d..c43df13 100644
--- a/configure.ac
+++ b/configure.ac
@@ -378,6 +378,19 @@ AC_HEADER_DIRENT
 AC_HEADER_STDC
 # after _HEADER_STDC
 AC_CHECK_HEADERS([sys/param.h sys/mman.h sys/select.h locale.h memory.h getopt.h unistd.h mcheck.h limits.h sys/time.h langinfo.h])
+
+dnl If sys/mman.h is present, check whether mmap requires the mman
+dnl library (see camlibs/st2205/st2205.c st2205_malloc_page_aligned()).
+MMAP_LIBS=""
+AS_VAR_IF([ac_cv_header_sys_mman_h], [yes], [dnl
+gp_saved_LIBS="$LIBS"
+LIBS=""
+AC_SEARCH_LIBS([mmap], [mman])
+MMAP_LIBS="$LIBS"
+LIBS="$gp_saved_LIBS"
+])dnl
+AC_SUBST([MMAP_LIBS])
+
 AC_C_INLINE([])
 AC_C_CONST([])
 dnl FIXME: AC_STRUCT_TIMEZONE
diff --git a/libgphoto2/gphoto2-setting.c b/libgphoto2/gphoto2-setting.c
index cfe2438..0a5b770 100644
--- a/libgphoto2/gphoto2-setting.c
+++ b/libgphoto2/gphoto2-setting.c
@@ -37,7 +37,7 @@
 #ifdef WIN32
 /* Win32 headers may use interface as a define; temporarily correct this */
 #define interface struct
-#include <Shlobj.h>
+#include <shlobj.h>
 #undef interface
 #endif
 
