This file is part of MXE.
See index.html for further information.

From ce156951d6c3290d2e277fb103b2314f261b2833 Mon Sep 17 00:00:00 2001
From: Mark Brand <mabrand@mabrand.nl>
Date: Mon, 12 Nov 2012 12:28:25 +0100
Subject: [PATCH 1/2] disable shared libs (MXE-specific)


diff --git a/CMakeLists.txt b/CMakeLists.txt
index 30e8220..0ff3542 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -88,21 +88,6 @@ IF(UNIX AND NOT APPLE AND NOT CMAKE_CROSSCOMPILING AND NOT EXISTS "/etc/debian_v
 	ENDIF()
 ENDIF()
 
-# Shared library
-ADD_LIBRARY(
-	${VMIME_LIBRARY_NAME}
-	SHARED
-	${VMIME_LIBRARY_SRC_FILES}
-	${VMIME_LIBRARY_INCLUDE_FILES}
-)
-
-SET_TARGET_PROPERTIES(
-	${VMIME_LIBRARY_NAME}
-	PROPERTIES
-	VERSION    "${VMIME_VERSION}"
-	SOVERSION  "${VMIME_API_VERSION}"
-)
-
 # Static library
 #
 # Note: cannot have two targets with the same name so the static version has
@@ -122,19 +107,12 @@ SET_TARGET_PROPERTIES(
 
 # These next two lines are required but it is unclear exactly what they do.
 # The CMake FAQ mentions they are necessary and it does not work otherwise.
-SET_TARGET_PROPERTIES(${VMIME_LIBRARY_NAME} PROPERTIES CLEAN_DIRECT_OUTPUT 1)
 SET_TARGET_PROPERTIES(${VMIME_LIBRARY_NAME}-static PROPERTIES CLEAN_DIRECT_OUTPUT 1)
 
 SET(CMAKE_INSTALL_LIBDIR lib CACHE PATH "Output directory for libraries")
 
 # Installation of libraries
 INSTALL(
-	TARGETS ${VMIME_LIBRARY_NAME}
-	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT sharedlibs
-	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT sharedlibs
-)
-
-INSTALL(
 	TARGETS ${VMIME_LIBRARY_NAME}-static
 	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT staticlibs
 	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR} COMPONENT staticlibs
@@ -222,11 +200,7 @@ SET(CPACK_SOURCE_IGNORE_FILES          "\\\\.git;~$;build/")
 SET(CPACK_SOURCE_PACKAGE_FILE_NAME     ${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION})
 
 # Set components
-SET(CPACK_COMPONENTS_ALL sharedlibs staticlibs headers)
-
-SET(CPACK_COMPONENT_SHAREDLIBS_DISPLAY_NAME "Shared libraries")
-SET(CPACK_COMPONENT_SHAREDLIBS_DESCRIPTION
-	"Shared library for general use.")
+SET(CPACK_COMPONENTS_ALL staticlibs headers)
 
 SET(CPACK_COMPONENT_STATICLIBS_DISPLAY_NAME "Static libraries")
 SET(CPACK_COMPONENT_STATICLIBS_DESCRIPTION
@@ -236,7 +210,6 @@ SET(CPACK_COMPONENT_HEADERS_DISPLAY_NAME "C++ Headers")
 SET(CPACK_COMPONENT_HEADERS_DESCRIPTION
 	"C/C++ header files.")
 
-SET(CPACK_COMPONENT_SHAREDLIBS_GROUP "Development")
 SET(CPACK_COMPONENT_STATICLIBS_GROUP "Development")
 SET(CPACK_COMPONENT_HEADERS_GROUP    "Development")
 SET(CPACK_COMPONENT_GROUP_DEVELOPMENT_DESCRIPTION "")
@@ -440,12 +413,6 @@ IF(VMIME_HAVE_SASL_SUPPORT)
 		${GSASL_INCLUDE_DIR}
 	)
 
-	TARGET_LINK_LIBRARIES(
-		${VMIME_LIBRARY_NAME}
-		${TARGET_LINK_LIBRARIES}
-		${GSASL_LIBRARIES}
-	)
-
 	SET(VMIME_PKGCONFIG_LIBS "${VMIME_PKGCONFIG_LIBS} ${GSASL_LIBRARIES}")
 	SET(VMIME_PKGCONFIG_CFLAGS "${VMIME_PKGCONFIG_CFLAGS} ${GSASL_INCLUDE_DIR}")
 	SET(VMIME_PKGCONFIG_REQUIRES "${VMIME_PKGCONFIG_REQUIRES} libgsasl")
@@ -495,12 +462,6 @@ IF(VMIME_HAVE_TLS_SUPPORT)
 			${GNUTLS_LIBRARY_DIRS}
 		)
 
-		TARGET_LINK_LIBRARIES(
-			${VMIME_LIBRARY_NAME}
-			${TARGET_LINK_LIBRARIES}
-			${GNUTLS_LIBRARY}
-		)
-
 		SET(VMIME_PKGCONFIG_LIBS "${VMIME_PKGCONFIG_LIBS} ${GNUTLS_LIBRARY_DIRS} ${GNUTLS_LIBRARY}")
 		SET(VMIME_PKGCONFIG_CFLAGS "${VMIME_PKGCONFIG_CFLAGS} ${GNUTLS_INCLUDE_DIR}")
 		SET(VMIME_PKGCONFIG_REQUIRES "${VMIME_PKGCONFIG_REQUIRES} libgnutls")
@@ -512,12 +473,6 @@ IF(VMIME_HAVE_TLS_SUPPORT)
 			${OPENSSL_INCLUDE_DIR}
 		)
 
-		TARGET_LINK_LIBRARIES(
-			${VMIME_LIBRARY_NAME}
-			${TARGET_LINK_LIBRARIES}
-			${OPENSSL_LIBRARIES}
-		)
-
 		SET(VMIME_PKGCONFIG_LIBS "${VMIME_PKGCONFIG_LIBS} ${OPENSSL_LIBRARIES}")
 		SET(VMIME_PKGCONFIG_CFLAGS "${VMIME_PKGCONFIG_CFLAGS} ${OPENSSL_INCLUDE_DIR}")
 		SET(VMIME_PKGCONFIG_REQUIRES "${VMIME_PKGCONFIG_REQUIRES} libopenssl")
@@ -541,12 +496,6 @@ INCLUDE_DIRECTORIES(
 	${ICONV_INCLUDE_DIR}
 )
 
-TARGET_LINK_LIBRARIES(
-	${VMIME_LIBRARY_NAME}
-	${TARGET_LINK_LIBRARIES}
-	${ICONV_LIBRARIES}
-)
-
 
 ##############################################################################
 # Platform
@@ -579,11 +528,6 @@ IF(WIN32)
 	CHECK_LIBRARY_EXISTS("ws2_32" getch "${CMAKE_LIBRARY_PATH}" VMIME_HAVE_LIBWS2_32)
 
 	IF(VMIME_HAVE_LIBWS2_32)
-		TARGET_LINK_LIBRARIES(
-			${VMIME_LIBRARY_NAME}
-			${TARGET_LINK_LIBRARIES}
-			"ws2_32"
-		)
 	ENDIF()
 
 	# MLang
@@ -593,12 +537,6 @@ IF(WIN32)
 	IF(VMIME_HAVE_MLANG_H)
 		IF(VMIME_HAVE_MLANG_LIB)
 			SET(VMIME_HAVE_MLANG ON)
-
-			TARGET_LINK_LIBRARIES(
-				${VMIME_LIBRARY_NAME}
-				${TARGET_LINK_LIBRARIES}
-				"mlang"
-			)
 		ENDIF()
 	ENDIF()
 
@@ -617,21 +555,10 @@ CHECK_SYMBOL_EXISTS(SYS_gettid sys/syscall.h VMIME_HAVE_SYSCALL_GETTID)
 
 FIND_PACKAGE(Threads)
 
-TARGET_LINK_LIBRARIES(
-	${VMIME_LIBRARY_NAME}
-	${TARGET_LINK_LIBRARIES}
-	${CMAKE_THREAD_LIBS_INIT}
-)
-
 FIND_LIBRARY(PTHREAD_LIB pthread)
 
 IF(PTHREAD_LIB)
 	SET(VMIME_HAVE_PTHREAD 1)
-	TARGET_LINK_LIBRARIES(
-		${VMIME_LIBRARY_NAME}
-		${TARGET_LINK_LIBRARIES}
-		${PTHREAD_LIB}
-	)
 ELSE(PTHREAD_LIB)
 	SET(VMIME_HAVE_PTHREAD 0)
 ENDIF(PTHREAD_LIB)
-- 
1.7.10.4


From a9512fe1f639dfbdae1ab91825e0da228a40b55b Mon Sep 17 00:00:00 2001
From: Mark Brand <mabrand@mabrand.nl>
Date: Mon, 12 Nov 2012 13:58:12 +0100
Subject: [PATCH 2/2] add private dependencies to .pc file (MXE-specific)


diff --git a/libvmime.pc.in b/libvmime.pc.in
index 5745c52..d9e153f 100644
--- a/libvmime.pc.in
+++ b/libvmime.pc.in
@@ -7,6 +7,8 @@ Name: @VMIME_LIBRARY_NAME@
 Description: @VMIME_PACKAGE_DESCRIPTION@
 Version: @VMIME_PACKAGE_VERSION@
 Requires: @VMIME_PKGCONFIG_REQUIRES@
+Requires.private: gnutls libgsasl
 Libs: -L${libdir} -lvmime @VMIME_PKGCONFIG_LIBS@
+Libs.private: -liconv -lws2_32
 Cflags: -I${includedir}/ @VMIME_PKGCONFIG_CFLAGS@
 
-- 
1.7.10.4

